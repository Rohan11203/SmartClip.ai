FROM node:18-bullseye-slim

# 1. Install ffmpeg + pip + yt-dlp
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
      ffmpeg \
      python3-pip \
    && pip3 install yt-dlp \
    && rm -rf /var/lib/apt/lists/*

# 2. App setup
WORKDIR /usr/src/app
COPY package*.json ./
RUN npm ci
COPY tsconfig.json ./
COPY src ./src
RUN npm run build

EXPOSE $PORT
CMD ["node", "dist/index.js"]
